from typing import Dict, List
from contact_node import ContactNode

class HashIndex:
    def __init__(self):
        self.name_index: Dict[str, List[ContactNode]] = {} 
        self.phone_index: Dict[str, List[ContactNode]] = {}  

    def update_index(self, node: ContactNode, is_add: bool):
        name = node.name.lower()
        for i in range(1, len(name)+1):
            prefix = name[:i]
            if is_add:
                if prefix not in self.name_index:
                    self.name_index[prefix] = []
                self.name_index[prefix].append(node)
            else:
                if prefix in self.name_index:
                    self.name_index[prefix].remove(node)
                    if not self.name_index[prefix]:
                        del self.name_index[prefix]
        
        phone = node.phone
        for i in range(1, len(phone)+1):
            prefix = phone[:i]
            if is_add:
                if prefix not in self.phone_index:
                    self.phone_index[prefix] = []
                self.phone_index[prefix].append(node)
            else:
                if prefix in self.phone_index:
                    self.phone_index[prefix].remove(node)
                    if not self.phone_index[prefix]:
                        del self.phone_index[prefix]

    def find_name_prefix(self, prefix: str) -> List[Dict]:
       
        prefix = prefix.lower()
        nodes = self.name_index.get(prefix, [])
        return [node.to_dict() for node in nodes]

    def find_phone_prefix(self, prefix: str) -> List[Dict]:
        
        nodes = self.phone_index.get(prefix, [])
        return [node.to_dict() for node in nodes]